# Databricks notebook source
KPI_gold = 'Cell_Availability_KPI_gold'

# COMMAND ----------

# MAGIC %sql
# MAGIC OPTIMIZE hive_metastore.default.availability_lte_hr_silver

# COMMAND ----------

# MAGIC %sql
# MAGIC SELECT min(CalendarDate) as Min_Day , max(CalendarDate) as Max_Day ,min(hour24) as Min_Hour ,max(hour24) as Max_Hour FROM 
# MAGIC (
# MAGIC         select CalendarDate,hour24    from  hive_metastore.`default`.availability_lte_hr_silver
# MAGIC )k

# COMMAND ----------

# MAGIC %sql
# MAGIC SELECT * FROM vz_conf_ecell_silver limit 1000

# COMMAND ----------

# MAGIC %sql
# MAGIC  with v_conf_ecell_silver as (
# MAGIC select CLUSTER_NAME,REPLACE(ENODEB_ID,'VZ_','eNB_') ENODEB_ID,concat('cNum',ECELL_ID) ECELL_ID,DL_BANDWIDTH,FREQUENCY_BAND_INDICATOR,MARKET_NAME,NETWORK_NAME,SUB_MARKET_ID,SUB_MARKET_NAME from vz_conf_ecell_silver
# MAGIC )
# MAGIC select 
# MAGIC CLUSTER_NAME,ENODEB_ID,ECELL_ID,DL_BANDWIDTH,FREQUENCY_BAND_INDICATOR,MARKET_NAME,NETWORK_NAME,SUB_MARKET_ID,SUB_MARKET_NAME,
# MAGIC Daily,Hourly,NE_ID,LOCATION,
# MAGIC (CellAvailPmPeriodTime-ReadCellUnavailableTime) Cell_Availability_NUM,
# MAGIC CellAvailPmPeriodTime Cell_Availability_DENOM
# MAGIC from (
# MAGIC 	select 
# MAGIC 	cast(CalendarDate as Date) as Daily, hour24 as Hourly,NE_ID,LOCATION,	
# MAGIC 	sum(ReadCellUnavailableTime) ReadCellUnavailableTime,
# MAGIC 	sum(CellAvailPmPeriodTime) CellAvailPmPeriodTime
# MAGIC 	from (
# MAGIC 			select CalendarDate,hour24,NE_ID,LOCATION,
# MAGIC 			sum(ReadCellUnavailableTime_s_SUM) ReadCellUnavailableTime,
# MAGIC 			sum(CellAvailPmPeriodTime_s_SUM) CellAvailPmPeriodTime
# MAGIC 			from 
# MAGIC 			hive_metastore.`default`.availability_lte_hr_silver
# MAGIC 			group by CalendarDate,hour24,NE_ID,LOCATION		
# MAGIC 	) y group by CalendarDate,hour24,NE_ID,LOCATION
# MAGIC ) x
# MAGIC INNER join v_conf_ecell_silver b  on b.ENODEB_ID=x.NE_ID and b.ECELL_ID=x.LOCATION 

# COMMAND ----------

gold_kpi = _sqldf
display(gold_kpi)

# COMMAND ----------

Gold_exists = spark.catalog.tableExists(KPI_gold)
print("GOLD exist: " + str(Gold_exists))
  
if str(Gold_exists) == 'True':
    print("GOLD exists Overwriting GOLD") 
    gold_kpi.write.format("delta").mode("overwrite").option("overwriteSchema", "true").saveAsTable(KPI_gold)
else:
    print("GOLD didn't Exist Saving Data as GOLD") 
    gold_kpi.write.format("delta").saveAsTable(KPI_gold)

# COMMAND ----------

spark.sql(f'OPTIMIZE {KPI_gold}')

# COMMAND ----------

sqdf2 = spark.sql(f'select * from  {KPI_gold}')
display(sqdf2)

# COMMAND ----------

# MAGIC %sql
# MAGIC
# MAGIC select * from cell_availability_kpi_gold where ENODEB_ID in (
# MAGIC 'eNB_73006','eNB_73007','eNB_73010','eNB_73019','eNB_73029','eNB_73034','eNB_73094','eNB_73109','eNB_73158','eNB_73171','eNB_73178','eNB_73181','eNB_73202','eNB_73204','eNB_73221','eNB_73235','eNB_73238','eNB_73337','eNB_73345','eNB_73466','eNB_73481','eNB_73485','eNB_73489','eNB_73516','eNB_73552','eNB_73555','eNB_73565','eNB_73570','eNB_73824','eNB_73846','eNB_73850','eNB_73877','eNB_73941','eNB_73991','eNB_132105','eNB_132107','eNB_132175','eNB_132242','eNB_132268','eNB_132395','eNB_132438','eNB_132633','eNB_132634','eNB_132674','eNB_132710','eNB_132722','eNB_132724','eNB_132741','eNB_132742','eNB_132744','eNB_132750','eNB_132849','eNB_132903','eNB_132925','eNB_132956','eNB_132973','eNB_68218','eNB_68394','eNB_68417','eNB_68423','eNB_68433','eNB_68540','eNB_68547','eNB_68548','eNB_68559','eNB_68566','eNB_68598','eNB_68602','eNB_68609','eNB_68611','eNB_68648','eNB_68665','eNB_68666','eNB_68784','eNB_68894','eNB_68979','eNB_88285','eNB_88368','eNB_88457','eNB_132701','eNB_132712','eNB_68529','eNB_68987','eNB_73002','eNB_73003','eNB_114007','eNB_114011','eNB_114014','eNB_114015','eNB_114018','eNB_114020','eNB_114027','eNB_114029','eNB_114030','eNB_114033','eNB_114034','eNB_114035','eNB_114036','eNB_114037','eNB_114038','eNB_114040','eNB_114042','eNB_114046','eNB_114048','eNB_114049','eNB_114050','eNB_114059','eNB_114065','eNB_114067','eNB_114069','eNB_114070','eNB_114081','eNB_114082','eNB_114089','eNB_114090','eNB_114094','eNB_114095','eNB_114105','eNB_114107','eNB_114109','eNB_114110','eNB_114113','eNB_114116','eNB_114118','eNB_114119','eNB_114121','eNB_114124','eNB_114125','eNB_114130','eNB_114132','eNB_132001','eNB_132006','eNB_132010','eNB_132011','eNB_132019','eNB_132020','eNB_132021','eNB_132022','eNB_132023','eNB_132024','eNB_132029','eNB_132031','eNB_132034','eNB_132037','eNB_132039','eNB_132044','eNB_132050','eNB_132077','eNB_132081','eNB_132084','eNB_132086','eNB_132087','eNB_132088','eNB_132089','eNB_132090','eNB_132092','eNB_132093','eNB_132094','eNB_132097','eNB_132099','eNB_132103','eNB_132104','eNB_132105','eNB_132108','eNB_132109','eNB_132110','eNB_132111','eNB_132112','eNB_132113','eNB_132114','eNB_132116','eNB_132117','eNB_132119','eNB_132120','eNB_132122','eNB_132123','eNB_132125','eNB_132126','eNB_132127','eNB_132128','eNB_132129','eNB_132130','eNB_132133','eNB_132141','eNB_132142','eNB_132149','eNB_132153','eNB_132158','eNB_132161','eNB_132164','eNB_132166','eNB_132175','eNB_132179','eNB_132191','eNB_132195','eNB_132196','eNB_132197','eNB_132198','eNB_132201','eNB_132219','eNB_132227','eNB_132242','eNB_132255','eNB_132264','eNB_132268','eNB_132279','eNB_132290','eNB_132300','eNB_132304','eNB_132309','eNB_132311','eNB_132323','eNB_132336','eNB_132337','eNB_132340','eNB_132341','eNB_132345','eNB_131001','eNB_131003','eNB_131004','eNB_131007','eNB_131008','eNB_131011','eNB_131012','eNB_131013','eNB_131015','eNB_131016','eNB_131018','eNB_131020','eNB_131022','eNB_131023','eNB_131024','eNB_131026','eNB_131027','eNB_131030','eNB_131031','eNB_131032','eNB_131033','eNB_131034','eNB_131035','eNB_131036','eNB_131037','eNB_131039','eNB_131041','eNB_131042','eNB_131044','eNB_131047','eNB_131048','eNB_131051','eNB_131057','eNB_131058','eNB_131065','eNB_131068','eNB_131076','eNB_131079','eNB_131081','eNB_131082','eNB_131085','eNB_131087','eNB_131088','eNB_131089','eNB_131090','eNB_131091','eNB_131093','eNB_131094','eNB_131096','eNB_131098','eNB_131099','eNB_131112','eNB_131115','eNB_131116','eNB_131117','eNB_131118','eNB_131145','eNB_131155','eNB_131157','eNB_131159','eNB_131161','eNB_131162','eNB_131165','eNB_131199','eNB_131227','eNB_131242','eNB_131244','eNB_131251','eNB_131252','eNB_131253','eNB_131255','eNB_131256','eNB_131257','eNB_131259','eNB_131260','eNB_131261','eNB_131262','eNB_68206','eNB_68214','eNB_68222','eNB_68312','eNB_68375','eNB_68415','eNB_68421','eNB_68425','eNB_68431','eNB_68435','eNB_68437','eNB_68439','eNB_68441','eNB_68443','eNB_68445','eNB_68447','eNB_68449','eNB_68451','eNB_68453','eNB_68455','eNB_68487','eNB_68489','eNB_68508','eNB_68511','eNB_68513','eNB_68528','eNB_68535','eNB_68536','eNB_68539','eNB_68541','eNB_68542','eNB_68543','eNB_68544','eNB_68545','eNB_68546','eNB_68549','eNB_68551','eNB_68552','eNB_68553','eNB_68554','eNB_68555','eNB_68557','eNB_68560','eNB_68561','eNB_68577','eNB_68624','eNB_68960','eNB_68852','eNB_68903','eNB_68846','eNB_68944','eNB_73180','eNB_73226','eNB_73242','eNB_73274','eNB_73001','eNB_73005','eNB_73008','eNB_73011','eNB_73015','eNB_73016','eNB_73017','eNB_73018','eNB_73020','eNB_73022','eNB_73023','eNB_73024','eNB_73025','eNB_73026','eNB_73028','eNB_73030','eNB_73033','eNB_73035','eNB_73036','eNB_73037','eNB_73038','eNB_73039','eNB_73041','eNB_73042','eNB_73043','eNB_73046','eNB_73047','eNB_73049','eNB_73051','eNB_73052','eNB_73054','eNB_73056','eNB_73057','eNB_73059','eNB_73060','eNB_73061','eNB_73062','eNB_73064','eNB_73065','eNB_73066','eNB_73067','eNB_73068','eNB_73070','eNB_73071','eNB_73072','eNB_73074','eNB_73075','eNB_73076','eNB_73077','eNB_73078','eNB_73079','eNB_73080','eNB_73081','eNB_73082','eNB_73083','eNB_73084','eNB_73086','eNB_73087','eNB_73088','eNB_73089','eNB_73090','eNB_73091','eNB_73092','eNB_73093','eNB_73095','eNB_73098','eNB_73100','eNB_73101','eNB_73102','eNB_73103','eNB_73105','eNB_73106','eNB_73107','eNB_73110','eNB_73112','eNB_73113','eNB_73115','eNB_73117','eNB_73119','eNB_73120','eNB_73121','eNB_73122','eNB_73123','eNB_73124','eNB_73217','eNB_73267','eNB_73224','eNB_73244','eNB_73269','eNB_73268','eNB_73248','eNB_73340','eNB_73283','eNB_73137','eNB_73138','eNB_88004','eNB_88023','eNB_88025','eNB_88031','eNB_88037','eNB_88040','eNB_88042','eNB_88044','eNB_88045','eNB_88047','eNB_88049','eNB_88051','eNB_88052','eNB_88054','eNB_88055','eNB_88056','eNB_88058','eNB_88062','eNB_88069','eNB_88071','eNB_88074','eNB_88079','eNB_88081','eNB_88086','eNB_88088','eNB_88091','eNB_88096','eNB_88099','eNB_88102','eNB_88103','eNB_88105','eNB_88118','eNB_88121','eNB_88123','eNB_88125','eNB_88126','eNB_88127','eNB_88129','eNB_88130','eNB_88131','eNB_88132','eNB_88133','eNB_88136','eNB_88137','eNB_88138','eNB_88141','eNB_88142','eNB_88144','eNB_88146','eNB_88147','eNB_88149','eNB_88154','eNB_88156','eNB_88157','eNB_88160','eNB_88161','eNB_88164','eNB_88165','eNB_88174','eNB_88178','eNB_88180','eNB_88184','eNB_88190','eNB_88194','eNB_88195','eNB_88198','eNB_88199','eNB_88201','eNB_88202','eNB_88204','eNB_88205','eNB_88206','eNB_88207','eNB_88208','eNB_88209','eNB_88227','eNB_88231','eNB_88234','eNB_88236','eNB_88237','eNB_88238','eNB_88239','eNB_88241','eNB_88415','eNB_88405','eNB_131264','eNB_131266','eNB_131268','eNB_131270','eNB_131272','eNB_131273','eNB_131274','eNB_131275','eNB_131276','eNB_131279','eNB_131280','eNB_131282','eNB_131283','eNB_131284','eNB_131286','eNB_131287','eNB_131288','eNB_131290','eNB_131291','eNB_131294','eNB_131297','eNB_131317','eNB_131318','eNB_131319','eNB_131322','eNB_131324','eNB_131329','eNB_131330','eNB_131341','eNB_131343','eNB_131357','eNB_131374','eNB_131379','eNB_131381','eNB_131382','eNB_131390','eNB_131394','eNB_131396','eNB_131398','eNB_131407','eNB_131409','eNB_131413','eNB_131415','eNB_131416','eNB_131427','eNB_131454','eNB_131455','eNB_131467','eNB_131471','eNB_131475','eNB_131477','eNB_131479','eNB_131480','eNB_131481','eNB_131482','eNB_131485','eNB_131488','eNB_131490','eNB_131491','eNB_131492','eNB_131501','eNB_131502','eNB_131503','eNB_131507','eNB_131532','eNB_131534','eNB_131537','eNB_131543','eNB_131550','eNB_131551','eNB_131552','eNB_131568','eNB_131571','eNB_131573','eNB_131574','eNB_131575','eNB_131579','eNB_131592','eNB_131597','eNB_131601','eNB_131025','eNB_131137','eNB_132346','eNB_132349','eNB_132361','eNB_132366','eNB_132399','eNB_132415','eNB_132416','eNB_132421','eNB_132432','eNB_132436','eNB_132437','eNB_132446','eNB_132449','eNB_132450','eNB_132451','eNB_132453','eNB_132455','eNB_132456','eNB_132460','eNB_132461','eNB_132462','eNB_132463','eNB_132464','eNB_132468','eNB_132469','eNB_132478','eNB_132499','eNB_132504','eNB_132529','eNB_132530','eNB_132531','eNB_132546','eNB_132553','eNB_132561','eNB_132564','eNB_132566','eNB_132567','eNB_132587','eNB_132593','eNB_132611','eNB_132613','eNB_132615','eNB_132625','eNB_132628','eNB_132630','eNB_132631','eNB_132632','eNB_132635','eNB_132636','eNB_132637','eNB_132638','eNB_132639','eNB_132640','eNB_132641','eNB_132642','eNB_132645','eNB_132646','eNB_132647','eNB_132648','eNB_132649','eNB_132650','eNB_132651','eNB_132652','eNB_132654','eNB_132655','eNB_132656','eNB_132657','eNB_132658','eNB_132659','eNB_132660','eNB_132661','eNB_132662','eNB_132663','eNB_132664','eNB_132665','eNB_132666','eNB_132667','eNB_132668','eNB_132669','eNB_132670','eNB_132671','eNB_132672','eNB_132673','eNB_132675','eNB_132676','eNB_132678','eNB_132679','eNB_132680','eNB_132681','eNB_132682','eNB_132038','eNB_132781','eNB_132932','eNB_132106','eNB_68705','eNB_68707','eNB_68708','eNB_68710','eNB_68711','eNB_68712','eNB_68714','eNB_68716','eNB_68717','eNB_68718','eNB_68720','eNB_68722','eNB_68724','eNB_68725','eNB_68726','eNB_68728','eNB_68730','eNB_68739','eNB_68766','eNB_68772','eNB_68773','eNB_68775','eNB_68777','eNB_68781','eNB_68782','eNB_68783','eNB_68785','eNB_68786','eNB_68787','eNB_68788','eNB_68789','eNB_68790','eNB_68791','eNB_68792','eNB_68793','eNB_68794','eNB_68795','eNB_68796','eNB_68797','eNB_68810','eNB_68811','eNB_68814','eNB_68815','eNB_68817','eNB_68818','eNB_68821','eNB_68823','eNB_68829','eNB_68831','eNB_68838','eNB_68843','eNB_68851','eNB_68853','eNB_68854','eNB_68859','eNB_68863','eNB_68864','eNB_68866','eNB_68867','eNB_68868','eNB_68869','eNB_68878','eNB_73144','eNB_73145','eNB_73146','eNB_73147','eNB_73149','eNB_73150','eNB_73151','eNB_73152','eNB_73153','eNB_73154','eNB_73155','eNB_73156','eNB_73157','eNB_73159','eNB_73160','eNB_73162','eNB_73165','eNB_73168','eNB_73169','eNB_73170','eNB_73172','eNB_73173','eNB_73176','eNB_73179','eNB_73182','eNB_73183','eNB_73184','eNB_73185','eNB_73186','eNB_73187','eNB_73188','eNB_73191','eNB_73194','eNB_73195','eNB_73196','eNB_73197','eNB_73198','eNB_73199','eNB_73201','eNB_73203','eNB_73207','eNB_73208','eNB_73210','eNB_73211','eNB_73212','eNB_73214','eNB_73215','eNB_73216','eNB_73218','eNB_73222','eNB_73223','eNB_73227','eNB_73228','eNB_73229','eNB_73230','eNB_73231','eNB_73232','eNB_73233','eNB_73234','eNB_73239','eNB_73240','eNB_73241','eNB_73243','eNB_73246','eNB_73247','eNB_73249','eNB_73250','eNB_73251','eNB_73252','eNB_73253','eNB_73254','eNB_73255','eNB_73256','eNB_73257','eNB_73258','eNB_73260','eNB_73261','eNB_73262','eNB_73264','eNB_73270','eNB_73271','eNB_73273','eNB_73275','eNB_73276','eNB_73277','eNB_73278','eNB_73279','eNB_73280','eNB_73282','eNB_73285','eNB_73286','eNB_73287','eNB_73289','eNB_73291','eNB_73292','eNB_73293','eNB_73294','eNB_73295','eNB_73296','eNB_73297','eNB_88259','eNB_88261','eNB_88262','eNB_88264','eNB_88265','eNB_88266','eNB_88269','eNB_88270','eNB_88271','eNB_88272','eNB_88276','eNB_88279','eNB_88280','eNB_88281','eNB_88282','eNB_88284','eNB_88286','eNB_88288','eNB_88289','eNB_88290','eNB_88294','eNB_88295','eNB_88297','eNB_88298','eNB_88324','eNB_88327','eNB_88332','eNB_88335','eNB_88336','eNB_88337','eNB_88338','eNB_88344','eNB_88345','eNB_88348','eNB_88349','eNB_88350','eNB_88352','eNB_88353','eNB_88357','eNB_88358','eNB_88360','eNB_88362','eNB_88363','eNB_88364','eNB_88365','eNB_114416','eNB_114418','eNB_114423','eNB_114424','eNB_114430','eNB_114431','eNB_114432','eNB_114434','eNB_114439','eNB_114441','eNB_114442','eNB_114444','eNB_114447','eNB_114448','eNB_114451','eNB_114452','eNB_114454','eNB_114455','eNB_114460','eNB_114462','eNB_114463','eNB_114468','eNB_114475','eNB_114476','eNB_114477','eNB_114478','eNB_114480','eNB_114485','eNB_114493','eNB_114496','eNB_114501','eNB_114502','eNB_114504','eNB_114505','eNB_114513','eNB_114516','eNB_114521','eNB_114522','eNB_114523','eNB_114525','eNB_114527','eNB_114530','eNB_114532','eNB_114533','eNB_114534','eNB_114536','eNB_114538','eNB_114539','eNB_114550','eNB_114554','eNB_114557','eNB_114559','eNB_114563','eNB_114565','eNB_114567','eNB_114568','eNB_114569','eNB_114575','eNB_114576','eNB_114577','eNB_114579','eNB_114581','eNB_114587','eNB_114588','eNB_114594','eNB_114596','eNB_114601','eNB_114602','eNB_114608','eNB_114609','eNB_114615','eNB_114625','eNB_114632','eNB_114639','eNB_114648','eNB_114659','eNB_114670','eNB_114674','eNB_114677','eNB_114678','eNB_114680','eNB_114684','eNB_114685','eNB_114686','eNB_114693','eNB_114695','eNB_114731','eNB_114911','eNB_114992','eNB_414828','eNB_414830','eNB_414896','eNB_414900','eNB_414903','eNB_414922','eNB_414924','eNB_414925','eNB_414926','eNB_414936','eNB_414937','eNB_131627','eNB_131628','eNB_131629','eNB_131634','eNB_131650','eNB_131651','eNB_131652','eNB_131660','eNB_131661','eNB_131666','eNB_131782','eNB_131791','eNB_131794','eNB_131796','eNB_131797','eNB_131815','eNB_131824','eNB_131829','eNB_131830','eNB_131835','eNB_131852','eNB_131854','eNB_131855','eNB_131863','eNB_131866','eNB_131868','eNB_131881','eNB_131890','eNB_131891','eNB_131900','eNB_131901','eNB_131903','eNB_131904','eNB_131905','eNB_131907','eNB_131908','eNB_131914','eNB_131920','eNB_131921','eNB_131922','eNB_131924','eNB_131927','eNB_131928','eNB_132687','eNB_132688','eNB_132689','eNB_132690','eNB_132691','eNB_132693','eNB_132694','eNB_132695','eNB_132696','eNB_132697','eNB_132699','eNB_132700','eNB_132702','eNB_132704','eNB_132705','eNB_132706','eNB_132707','eNB_132708','eNB_132709','eNB_132711','eNB_132713','eNB_132714','eNB_132715','eNB_132716','eNB_132717','eNB_132718','eNB_132719','eNB_132720','eNB_132721','eNB_132723','eNB_132725','eNB_132726','eNB_132727','eNB_132728','eNB_132729','eNB_132730','eNB_132732','eNB_132733','eNB_132734','eNB_132735','eNB_132736','eNB_132738','eNB_132739','eNB_132740','eNB_132743','eNB_68003','eNB_68005','eNB_68051','eNB_68084','eNB_68148','eNB_68156','eNB_68192','eNB_68195','eNB_68199','eNB_68457','eNB_68562','eNB_68563','eNB_68564','eNB_68567','eNB_68569','eNB_68570','eNB_68579','eNB_68580','eNB_68581','eNB_68584','eNB_68585','eNB_68587','eNB_68589','eNB_68591','eNB_68593','eNB_68594','eNB_68595','eNB_68599','eNB_68600','eNB_68601','eNB_68608','eNB_68613','eNB_68616','eNB_68618','eNB_68619','eNB_68620','eNB_68621','eNB_68622','eNB_68623','eNB_68633','eNB_68635','eNB_68638','eNB_68639','eNB_68640','eNB_68641','eNB_68642','eNB_68643','eNB_68644','eNB_68645','eNB_68646','eNB_68647','eNB_68664','eNB_68701','eNB_68791','eNB_68879','eNB_68880','eNB_68881','eNB_68882','eNB_68883','eNB_68884','eNB_68886','eNB_68887','eNB_68888','eNB_68889','eNB_68890','eNB_68891','eNB_68892','eNB_68893','eNB_68895','eNB_68898','eNB_68900','eNB_68901','eNB_73125','eNB_73126','eNB_73127','eNB_73128','eNB_73129','eNB_73130','eNB_73131','eNB_73133','eNB_73134','eNB_73139','eNB_73141','eNB_73142','eNB_73143','eNB_73298','eNB_73299','eNB_73300','eNB_73307','eNB_73308','eNB_73310','eNB_73311','eNB_73312','eNB_73313','eNB_73315','eNB_73316','eNB_73317','eNB_73318','eNB_73319','eNB_73320','eNB_73321','eNB_73324','eNB_73325','eNB_73326','eNB_73327','eNB_73328','eNB_73329','eNB_73330','eNB_73331','eNB_73333','eNB_73335','eNB_73339','eNB_73342','eNB_73343','eNB_73344','eNB_73353','eNB_73364','eNB_73367','eNB_73411','eNB_73417','eNB_73448','eNB_73449','eNB_73460','eNB_73461','eNB_73462','eNB_73463','eNB_73465','eNB_73467','eNB_73468','eNB_73469','eNB_73470','eNB_73472','eNB_73474','eNB_73476','eNB_73479','eNB_73483','eNB_73484','eNB_73486','eNB_73487','eNB_73488','eNB_73491','eNB_73496','eNB_73502','eNB_73505','eNB_73507','eNB_73510','eNB_73512','eNB_73513','eNB_73514','eNB_73517','eNB_73518','eNB_73520','eNB_73522','eNB_73524','eNB_73528','eNB_73550','eNB_73551','eNB_73553','eNB_73556','eNB_73557','eNB_73572','eNB_73574','eNB_73575','eNB_73576','eNB_73577','eNB_73579','eNB_73609','eNB_73636','eNB_73713','eNB_73714','eNB_88001','eNB_88003','eNB_88014','eNB_88021','eNB_88022','eNB_88148','eNB_88244','eNB_88246','eNB_88247','eNB_88251','eNB_88252','eNB_88253','eNB_88254','eNB_88255','eNB_88257','eNB_88369','eNB_88371','eNB_88373','eNB_88374','eNB_88376','eNB_88377','eNB_88378','eNB_88379','eNB_88382','eNB_88383','eNB_88386','eNB_88388','eNB_88390','eNB_88393','eNB_88394','eNB_88395','eNB_88396','eNB_88401','eNB_88403','eNB_88410','eNB_88413','eNB_88418','eNB_88419','eNB_88423','eNB_88426','eNB_88428','eNB_88432','eNB_88433','eNB_88434','eNB_88453','eNB_88458','eNB_88468','eNB_88470','eNB_88473','eNB_88488','eNB_88495','eNB_88618','eNB_88652','eNB_88656','eNB_88813','eNB_88822','eNB_88836','eNB_88908','eNB_114135','eNB_114138','eNB_114139','eNB_114146','eNB_114147','eNB_114150','eNB_114156','eNB_114157','eNB_114161','eNB_114164','eNB_114166','eNB_114177','eNB_114179','eNB_114183','eNB_114186','eNB_114187','eNB_114188','eNB_114192','eNB_114195','eNB_114196','eNB_114198','eNB_114199','eNB_114244','eNB_114254','eNB_114259','eNB_114263','eNB_114264','eNB_114267','eNB_114272','eNB_114277','eNB_114282','eNB_114284','eNB_114285','eNB_114286','eNB_114293','eNB_114296','eNB_114299','eNB_114300','eNB_114301','eNB_114302','eNB_114303','eNB_114304','eNB_114305','eNB_114306','eNB_114307','eNB_114309','eNB_114310','eNB_114311','eNB_114314','eNB_114315','eNB_114316','eNB_114317','eNB_114318','eNB_114319','eNB_114320','eNB_114321','eNB_114322','eNB_114323','eNB_114324','eNB_114326','eNB_114327','eNB_114328','eNB_114330','eNB_114331','eNB_114333','eNB_114334','eNB_114342','eNB_114347','eNB_114350','eNB_114367','eNB_114369','eNB_114371','eNB_114374','eNB_114376','eNB_114377','eNB_114378','eNB_114379','eNB_114380','eNB_114384','eNB_114386','eNB_114390','eNB_114393','eNB_114395','eNB_114396','eNB_114400','eNB_114403','eNB_114404','eNB_114407','eNB_114409','eNB_114411','eNB_131602','eNB_131603','eNB_131604','eNB_131605','eNB_131606','eNB_131607','eNB_131608','eNB_131609','eNB_131610','eNB_131611','eNB_131616','eNB_131617','eNB_131618','eNB_131620','eNB_131621','eNB_131622','eNB_131623','eNB_131931','eNB_131933','eNB_131938','eNB_131940','eNB_131969','eNB_131970','eNB_131971','eNB_131975','eNB_131976','eNB_131985','eNB_131986','eNB_132745','eNB_132746','eNB_132747','eNB_132748','eNB_132749','eNB_132751','eNB_132752','eNB_132754','eNB_132756','eNB_132758','eNB_132770','eNB_132775','eNB_132776','eNB_132780','eNB_132784','eNB_132785','eNB_132786','eNB_132787','eNB_132788','eNB_132791','eNB_132792','eNB_132793','eNB_132800','eNB_132804','eNB_132805','eNB_132807','eNB_132814','eNB_132817','eNB_132820','eNB_132821','eNB_132823','eNB_132825','eNB_132828','eNB_132834','eNB_132837','eNB_132838','eNB_132839','eNB_132840','eNB_132841','eNB_132843','eNB_132847','eNB_132855','eNB_132856','eNB_132889','eNB_132898','eNB_132907','eNB_132909','eNB_132912','eNB_132915','eNB_132917','eNB_132918','eNB_132926','eNB_132938','eNB_132941','eNB_132949','eNB_132950','eNB_132952','eNB_132953','eNB_132954','eNB_132957','eNB_132958','eNB_132959','eNB_132960','eNB_132961','eNB_132962','eNB_132965','eNB_132966','eNB_132967','eNB_132968','eNB_132971','eNB_132972','eNB_132977','eNB_132978','eNB_132987','eNB_132990','eNB_68906','eNB_68908','eNB_68909','eNB_68910','eNB_68913','eNB_68914','eNB_68915','eNB_68916','eNB_68918','eNB_68919','eNB_68922','eNB_68924','eNB_68928','eNB_68929','eNB_68930','eNB_68932','eNB_68933','eNB_68934','eNB_68936','eNB_68938','eNB_68940','eNB_68942','eNB_68943','eNB_68945','eNB_68946','eNB_68948','eNB_68949','eNB_68952','eNB_68954','eNB_68955','eNB_68956','eNB_68957','eNB_68958','eNB_68962','eNB_68965','eNB_68968','eNB_68969','eNB_68970','eNB_68973','eNB_68974','eNB_68975','eNB_68976','eNB_68977','eNB_68978','eNB_68980','eNB_68981','eNB_68982','eNB_68983','eNB_68985','eNB_68991','eNB_68993','eNB_73571','eNB_73715','eNB_73820','eNB_73821','eNB_73823','eNB_73825','eNB_73837','eNB_73843','eNB_73845','eNB_73847','eNB_73848','eNB_73849','eNB_73851','eNB_73852','eNB_73853','eNB_73855','eNB_73857','eNB_73858','eNB_73861','eNB_73862','eNB_73864','eNB_73865','eNB_73867','eNB_73873','eNB_73874','eNB_73879','eNB_73881','eNB_73882','eNB_73883','eNB_73884','eNB_73887','eNB_73889','eNB_73890','eNB_73893','eNB_73894','eNB_73895','eNB_73897','eNB_73898','eNB_73901','eNB_73904','eNB_73906','eNB_73907','eNB_73912','eNB_73917','eNB_73918','eNB_73919','eNB_73920','eNB_73921','eNB_73922','eNB_73923','eNB_73924','eNB_73925','eNB_73926','eNB_73927','eNB_73929','eNB_73930','eNB_73931','eNB_73932','eNB_73933','eNB_73934','eNB_73936','eNB_73939','eNB_73940','eNB_73942','eNB_73944','eNB_73945','eNB_73949','eNB_73950','eNB_73952','eNB_73954','eNB_73956','eNB_73958','eNB_73966','eNB_73967','eNB_73970','eNB_73972','eNB_73975','eNB_73976','eNB_73979','eNB_73980','eNB_73981','eNB_73983','eNB_73984','eNB_73985','eNB_73986','eNB_73987','eNB_73988','eNB_73992','eNB_73994','eNB_73998','eNB_414938','eNB_414939','eNB_414940','eNB_414941','eNB_414942','eNB_414943','eNB_414944','eNB_414946','eNB_414947','eNB_414948','eNB_414949','eNB_414950','eNB_414951','eNB_414952','eNB_414953','eNB_414956','eNB_414957','eNB_414959','eNB_414960','eNB_414961','eNB_414962','eNB_414963','eNB_414967','eNB_414968','eNB_414969','eNB_414970','eNB_414971','eNB_414972','eNB_131624','eNB_131626','eNB_131631','eNB_132683','eNB_132684','eNB_132685','eNB_132686','eNB_132991','eNB_132993','eNB_132996','eNB_132997','eNB_132998','eNB_132999','eNB_114435','eNB_114697','eNB_114165','eNB_114813','eNB_114313','eNB_414902','eNB_114191','eNB_114481','eNB_114142','eNB_114074','eNB_114605','eNB_114303','eNB_114106','eNB_114159','eNB_114604','eNB_114449','eNB_114663','eNB_114028','eNB_114255','eNB_114075','eNB_114006','eNB_114086','eNB_114174','eNB_114239','eNB_114332','eNB_114128','eNB_114383','eNB_114135','eNB_114443','eNB_114060','eNB_114189','eNB_114292','eNB_114294','eNB_114018','eNB_114368','eNB_114171','eNB_114661','eNB_114586','eNB_114253','eNB_114405','eNB_114180','eNB_114325','eNB_114101','eNB_131893','eNB_132622','eNB_131974','eNB_131052','eNB_132595','eNB_132190','eNB_131499','eNB_132845','eNB_132172','eNB_131619','eNB_131144','eNB_131168','eNB_131043','eNB_131498','eNB_131809','eNB_132768','eNB_132964','eNB_131785','eNB_131989','eNB_131805','eNB_132811','eNB_132955','eNB_131322','eNB_132842','eNB_131863','eNB_132731','eNB_131245','eNB_131667','eNB_131021','eNB_132544','eNB_132790','eNB_132375','eNB_132115','eNB_131123','eNB_131528','eNB_131349','eNB_132098','eNB_131188','eNB_132302','eNB_131463','eNB_131119','eNB_131269','eNB_132184','eNB_132772','eNB_132904','eNB_132040','eNB_132004','eNB_132661','eNB_132431','eNB_131173','eNB_132974','eNB_132174','eNB_132018','eNB_132027','eNB_131567','eNB_68665','eNB_68666','eNB_132038','eNB_139890','eNB_73022','eNB_73033','eNB_73049','eNB_73052','eNB_73066','eNB_73001','eNB_73056','eNB_73071','eNB_73101','eNB_73169','eNB_73191','eNB_73217','eNB_73222','eNB_73230','eNB_73264','eNB_73287','eNB_73298','eNB_73327','eNB_73002','eNB_73003','eNB_73006','eNB_73007','eNB_73011','eNB_73016','eNB_73018','eNB_73025','eNB_73026','eNB_73034','eNB_73035','eNB_73045','eNB_73051','eNB_73055','eNB_73057','eNB_73062','eNB_73064','eNB_73067','eNB_73068','eNB_73069','eNB_73073','eNB_73080','eNB_73081','eNB_73084','eNB_73090','eNB_73096','eNB_73097','eNB_73099','eNB_73102','eNB_73105','eNB_73106','eNB_73109','eNB_73110','eNB_73111','eNB_73119','eNB_73120','eNB_73123','eNB_73125','eNB_73127','eNB_73140','eNB_73144','eNB_73146','eNB_73149','eNB_73153','eNB_73171','eNB_73179','eNB_73181','eNB_73182','eNB_73184','eNB_73185','eNB_73019','eNB_73193','eNB_73201','eNB_73029','eNB_73221','eNB_73233','eNB_73070','eNB_73078','eNB_73244','eNB_73246','eNB_73248','eNB_73255','eNB_73267','eNB_73268','eNB_73269','eNB_73273','eNB_73274','eNB_73277','eNB_73278','eNB_73283','eNB_73300','eNB_73316','eNB_73318','eNB_73324','eNB_73326','eNB_73340','eNB_73079','eNB_73353','eNB_73492','eNB_73520','eNB_73089','eNB_73837','eNB_73129','eNB_73218','eNB_73231','eNB_73234','eNB_73239','eNB_73329','eNB_73345','eNB_73523'
# MAGIC )

# COMMAND ----------

test_kpi = _sqldf
KPI_test = 'Cell_Availability_KPI_gold_test'

# COMMAND ----------

Gold_exists = spark.catalog.tableExists(KPI_test)
print("GOLD exist: " + str(Gold_exists))
  
if str(Gold_exists) == 'True':
    print("GOLD exists Overwriting GOLD") 
    test_kpi.write.format("delta").mode("overwrite").option("overwriteSchema", "true").saveAsTable(KPI_test)
else:
    print("GOLD didn't Exist Saving Data as GOLD") 
    test_kpi.write.format("delta").saveAsTable(KPI_test)

# COMMAND ----------

spark.sql(f'OPTIMIZE {KPI_test}')

# COMMAND ----------

# MAGIC %sql
# MAGIC select distinct(NE_ID) from Cell_Availability_KPI_gold_test
